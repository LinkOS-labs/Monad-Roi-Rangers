<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mint – Monad Roi Rangers</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.12.0/dist/ethers.umd.min.js"></script>

<style>
body {
  margin:0; padding:0;
  font-family:Arial, sans-serif;
  background: #0a0e0a;
  color:#e6f5d0;
}

/* simple camouflage */
.bg {
  background:
    radial-gradient(circle at 20% 30%, rgba(40,60,30,0.7), transparent 60%),
    radial-gradient(circle at 80% 0%, rgba(60,80,50,0.6), transparent 55%),
    radial-gradient(circle at 0% 80%, rgba(30,40,20,0.7), transparent 50%),
    linear-gradient(#0a0e0a,#141a12);
  min-height:100vh;
  padding:20px;
}

.card {
  background:rgba(5,8,5,0.85);
  border:1px solid rgba(190,255,120,0.3);
  padding:20px;
  max-width:400px;
  margin:40px auto;
  border-radius:15px;
}

.btn {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:1px solid #c8f76e;
  background:#c8f76e;
  color:#122000;
  font-weight:bold;
  cursor:pointer;
}

.btn2 {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:1px solid #c8f76e;
  background:transparent;
  color:#c8f76e;
  cursor:pointer;
}

input {
  width:100%;
  margin-top:10px;
  padding:10px;
  border-radius:8px;
  border:1px solid #c8f76e;
  background:#0d120d;
  color:white;
}

#status {
  margin-top:15px;
  white-space:pre-line;
  font-size:14px;
}
</style>
</head>

<body>
<div class="bg">
  <div class="card">
    <h2 style="text-align:center;">MONAD ROI RANGERS</h2>
    <p style="text-align:center;">Mint price: <b>5 MONAD</b></p>

    <input type="number" id="qty" min="1" max="20" value="1">

    <button id="connectBtn" class="btn">Connect Wallet</button>
    <button id="mintBtn" class="btn2" disabled>Mint</button>

    <div id="status">Status: Idle</div>
  </div>
</div>


<script>
const CONTRACT = "0xF81737682eBD3B51F44c4321a67305F90B73D622";
const RPC = "https://rpc.monad.xyz";

const ABI = [
  "function mint(uint256 quantity) external payable"
];

/* EXACT provider-detection from your working sample */
function getInjected() {
  if (window.ethereum && Array.isArray(window.ethereum.providers)) {
    const p = window.ethereum.providers;
    return p.find(x => x.isMetaMask) ||
           p.find(x => x.isPhantom) ||
           p[0];
  }
  if (window.phantom && window.phantom.ethereum) return window.phantom.ethereum;
  if (window.ethereum) return window.ethereum;
  return null;
}

let provider, signer, contract;

function log(msg){
  document.getElementById("status").innerText = msg;
}

document.getElementById("connectBtn").onclick = async () => {
  try {
    const injected = getInjected();
    if (!injected) {
      log("⚠ No EVM wallet detected");
      return;
    }

    const acc = await injected.request({ method: "eth_requestAccounts" });
    provider = new ethers.BrowserProvider(injected);
    signer = await provider.getSigner();
    contract = new ethers.Contract(CONTRACT, ABI, signer);

    log("Connected: " + acc[0]);
    document.getElementById("mintBtn").disabled = false;

  } catch(e){
    log("Connect error:\n" + e.message);
  }
};

document.getElementById("mintBtn").onclick = async () => {
  try {
    if (!contract) {
      log("Connect wallet first");
      return;
    }

    const qty = parseInt(document.getElementById("qty").value);
    if (!qty || qty < 1) {
      log("Invalid quantity");
      return;
    }

    // FIXED: calculate total cost manually — no MINT_PRICE()
    const totalCost = ethers.parseEther((5 * qty).toString());

    log("Sending mint…");

    const tx = await contract.mint(qty, {
      value: totalCost,
      gasLimit: 250000n * BigInt(qty)
    });

    log("Waiting for confirmation…\n" + tx.hash);

    const r = await tx.wait();
    log("✅ Minted!\nTx: " + r.hash);

  } catch(e){
    log("Mint error:\n" + (e.reason || e.message));
  }
};
</script>

</body>
</html>
